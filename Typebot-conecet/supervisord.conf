[supervisord]
; roda em primeiro plano (obrigatório no Railway)
nodaemon=true
; desabilita log interno do supervisor para evitar "Illegal seek"
logfile=/dev/null
loglevel=info
pidfile=/tmp/supervisord.pid
user=root
strip_ansi=true

; =============================
; Programas principais
; =============================

[program:bridge]
directory=/app
command=python3 -m uvicorn app_bridge:app --host 0.0.0.0 --port 8080
autostart=true
autorestart=true
startsecs=3
stopsignal=TERM
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=PYTHONPATH="/app"

[program:admin]
directory=/app
command=python3 -m uvicorn bot_gesto.admin_service:app --host 0.0.0.0 --port 8000 --log-level info
autostart=true
autorestart=true
startsecs=3
stopsignal=TERM
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=PYTHONPATH="/app"

[program:bot]
directory=/app
; executa como módulo para que 'from bot_gesto.*' funcione
command=python3 -m bot_gesto.bot
autostart=true
autorestart=true
startsecs=3
stopsignal=TERM
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=PYTHONPATH="/app"

[program:worker]
directory=/app
command=python3 -m bot_gesto.worker
autostart=false
autorestart=false
startsecs=3
stopsignal=TERM
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=PYTHONPATH="/app"

[program:retrofeed]
directory=/app
command=python3 -m bot_gesto.retrofeed
autostart=false
autorestart=true
startsecs=3
stopsignal=TERM
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=PYTHONPATH="/app"